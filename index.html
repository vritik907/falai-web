<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>fal.ai Image Edit</title>
  <style>
    body { background:#0b0d17; color:#fff; font-family:Arial; padding:30px }
    textarea, input { width:100%; margin-top:10px; padding:10px }
    button { margin-top:20px; padding:15px; width:100%; font-size:18px }
    pre { background:black; padding:10px; margin-top:20px }
  </style>
</head>
<body>

<h2>fal.ai Image Edit (Reference Images Required)</h2>

<label>Model</label>
<input id="model" value="fal-ai/nano-banana-pro/edit" />

<label>Reference Images (required)</label>
<input id="images" type="file" multiple accept="image/*" />

<label>Prompt</label>
<textarea id="prompt">clone car</textarea>

<button onclick="generate()">ðŸš€ Generate</button>

<pre id="log"></pre>

<script>
async function generate() {
  const files = document.getElementById("images").files;
  const prompt = document.getElementById("prompt").value;
  const model = document.getElementById("model").value;
  const log = document.getElementById("log");

  if (!files.length) {
    alert("Reference images required");
    return;
  }

  log.textContent = "Uploading & generating...\n";

  const images = [];

  for (const file of files) {
    const base64 = await toBase64(file);
    images.push({
      name: file.name,
      type: file.type,
      data: base64.split(",")[1] // IMPORTANT
    });
  }

  const res = await fetch("/.netlify/functions/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ model, prompt, images })
  });

  const json = await res.json();
  log.textContent += JSON.stringify(json, null, 2);
}

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}
</script>

</body>
</html>
