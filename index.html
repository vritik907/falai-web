<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>fal.ai Image Editor</title>
<style>
  body {
    background: #0f0f1a;
    color: #fff;
    font-family: Arial, sans-serif;
    padding: 30px;
  }
  textarea, input, button {
    width: 100%;
    margin-top: 10px;
    padding: 10px;
    border-radius: 6px;
    border: none;
  }
  button {
    background: linear-gradient(90deg,#3b82f6,#8b5cf6);
    color: #fff;
    font-weight: bold;
    cursor: pointer;
  }
  .log {
    margin-top: 20px;
    background: #000;
    padding: 15px;
    font-family: monospace;
    color: #00ff88;
  }
</style>
</head>

<body>

<h2>fal.ai Image Edit (Reference Images Required)</h2>

<label>Model</label>
<input id="model" value="fal-ai/nano-banana-pro/edit" />

<label>Reference Images (required)</label>
<input id="images" type="file" accept="image/*" multiple />

<label>Prompt</label>
<textarea id="prompt" rows="4">clone car</textarea>

<button onclick="generate()">ðŸš€ Generate</button>

<div class="log" id="log"></div>

<script>
function log(msg) {
  document.getElementById("log").innerHTML += msg + "<br>";
}

async function filesToBase64(files) {
  const out = [];
  for (const file of files) {
    const base64 = await new Promise((res, rej) => {
      const reader = new FileReader();
      reader.onload = () => res(reader.result.split(",")[1]);
      reader.onerror = rej;
      reader.readAsDataURL(file);
    });
    out.push({
      name: file.name,
      type: file.type,
      data: base64
    });
  }
  return out;
}

async function generate() {
  document.getElementById("log").innerHTML = "";
  log("Uploading & generating...");

  const model = document.getElementById("model").value;
  const prompt = document.getElementById("prompt").value;
  const files = document.getElementById("images").files;

  if (!files.length) {
    alert("Reference images are required");
    return;
  }

  const images = await filesToBase64(files);

  const res = await fetch("/.netlify/functions/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ model, prompt, images })
  });

  const data = await res.json();

  if (data.error) {
    log("âŒ " + data.error);
    return;
  }

  data.images.forEach(url => {
    const img = document.createElement("img");
    img.src = url;
    img.style.width = "300px";
    img.style.marginTop = "10px";
    document.body.appendChild(img);
  });

  log("âœ… Done");
}
</script>

</body>
</html>
